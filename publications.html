<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Publications</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Shared CSS -->
  <link rel="stylesheet" href="style.css">
</head>

<body>

<!-- Navigation -->
<nav>
  <ul>
    <li><a href="index.html">Home</a></li>
    <li><a href="team.html">Team</a></li>
    <li><a href="publications.html">Publications</a></li>
    <li><a href="clinical.html">Clinical Publications</a></li>
    <li><a href="contact.html">Contact</a></li>
  </ul>
</nav>

<main style="padding: 30px; max-width: 1100px; margin: auto;">

  <h1>Peer-reviewed Publications</h1>

  <!-- PubMed publications -->
  <section>
    <h2>Journal Articles</h2>
    <div id="pubmed-results">
      <p>Loading publications from PubMedâ€¦</p>
    </div>
  </section>

  <hr style="margin:40px 0;">

  <!-- Books -->
  <section>
    <h2>Books</h2>
    <ul>
      <li>Mock Book Title 1. Publisher, Year.</li>
      <li>Mock Book Title 2. Publisher, Year.</li>
    </ul>
  </section>

  <!-- Chapters -->
  <section>
    <h2>Book Chapters</h2>
    <ul>
      <li>Mock Chapter Title 1. In: Book Title. Publisher, Year.</li>
      <li>Mock Chapter Title 2. In: Book Title. Publisher, Year.</li>
    </ul>
  </section>

</main>

<!-- PubMed script -->
<script>
const PUBMED_QUERY = "Santulli G[Author]";
const MAX_RESULTS = 200;

async function fetchPubMed() {
  try {
    const searchURL =
      "https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi" +
      "?db=pubmed&retmode=json&retmax=" + MAX_RESULTS +
      "&sort=pub+date&term=" + encodeURIComponent(PUBMED_QUERY);

    const searchResponse = await fetch(searchURL);
    const searchData = await searchResponse.json();

    const ids = searchData.esearchresult.idlist;
    if (!ids || ids.length === 0) {
      document.getElementById("pubmed-results").innerHTML =
        "<p>No publications found.</p>";
      return;
    }

    const fetchURL =
      "https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi" +
      "?db=pubmed&retmode=xml&id=" + ids.join(",");

    const fetchResponse = await fetch(fetchURL);
    const xmlText = await fetchResponse.text();

    const parser = new DOMParser();
    const xml = parser.parseFromString(xmlText, "text/xml");

    const articles = xml.getElementsByTagName("PubmedArticle");
    let html = "<ol>";

    for (let article of articles) {
      const title =
        article.getElementsByTagName("ArticleTitle")[0]?.textContent || "";

      const journal =
        article.getElementsByTagName("Title")[0]?.textContent || "";

      const year =
        article.getElementsByTagName("Year")[0]?.textContent || "";

      const authors = Array.from(
        article.getElementsByTagName("Author")
      ).map(a => {
        const last = a.getElementsByTagName("LastName")[0]?.textContent || "";
        const initials = a.getElementsByTagName("Initials")[0]?.textContent || "";
        return last && initials ? `${last} ${initials}` : "";
      }).filter(Boolean).join(", ");

      let doi = "";
      const ids = article.getElementsByTagName("ArticleId");
      for (let id of ids) {
        if (id.getAttribute("IdType") === "doi") {
          doi = id.textContent;
        }
      }

      html += `
        <li style="margin-bottom:15px;">
          <strong>${title}</strong><br>
          ${authors}<br>
          <span style="color:green; font-weight:bold;">
            ${journal.toUpperCase()}
          </span>
          (${year})
          ${doi ? `<br>DOI: <a href="https://doi.org/${doi}" target="_blank">${doi}</a>` : ""}
        </li>
      `;
    }

    html += "</ol>";
    document.getElementById("pubmed-results").innerHTML = html;

  } catch (error) {
    document.getElementById("pubmed-results").innerHTML =
      "<p>Error loading publications.</p>";
    console.error(error);
  }
}

fetchPubMed();
</script>

</body>
</html>
